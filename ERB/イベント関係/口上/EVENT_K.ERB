;=================================================
;口上イベント管理
;=================================================
;調教時キャラ別口上を一括管理
;=================================================

;-----------------------------------------------------------------------------------
;口上用システムファイルの存在判定
;EVENT_K.ERB(つまりこのファイル)が存在しているかを判定
;口上が使用可能で口上機能を能動的にOFFにしていない場合には、自動的にスイッチが入る
;各口上ファイル内でキャラフラグを制御するので、
;EVENT_Kxx.ERB(キャラ別口上ファイル)を途中で削除してもエラーはでない
;ただし、口上をONにした状態でこのファイルを削除するとエラーが発生する
;あっても邪魔にはならないので削除しない方が良いだろう
;-----------------------------------------------------------------------------------
@EVENTSHOP
#PRI
SIF FLAG:口上使用 == 0
	FLAG:口上使用 = 2
;--------------------------------------------------
;@KOJO_MESSAGE_COM関係
;コマンド実行時に出力されます
;--------------------------------------------------
@KOJO_MESSAGE_COM
;失神時には口上は表示しない
SIF TFLAG:失神中終了 >= 1
	RETURN 0

SIF FLAG:口上使用 <= 0
	RETURN 0

;まあコマンドはTRYでいいか
;口上から地の文制御がしたいという希望がくれば考える
TRYCALLFORM KOJO_MESSAGE_COM_{NO:TARGET}

;-------------------------------------------------
;@KOJO_MESSAGE_PALAMCNG関係
;パラメータ変動をトリガーにした口上
;パラメータ変動後に口上を発動します
;-------------------------------------------------
@KOJO_MESSAGE_PALAMCNG
;失神時には口上は表示しない
SIF TFLAG:失神中終了 >= 1
	RETURN 0
	
SIF FLAG:口上使用 <= 0
	RETURN 0

;K_DUMMYの関数の多さが頭に来たと供述している。
;こっちもTRY
TRYCALLFORM KOJO_MESSAGE_PALAMCNG_{NO:TARGET}

;-------------------------------------------------
;@KOJO_MESSAGE_MARKCNG関係
;刻印変動をトリガーにした口上
;刻印変動後に口上を発動します
;-------------------------------------------------
@KOJO_MESSAGE_MARKCNG
;失神時には口上は表示しない
SIF TFLAG:失神中終了 >= 1
	RETURN 0

SIF FLAG:口上使用 <= 0
	RETURN 0

TRYCALLFORM KOJO_MESSAGE_MARKCNG_{NO:TARGET}

;-------------------------------------------------
;@SELF_KOJO関係
;イベント時の口上、イベント開始時に出力します
;-------------------------------------------------
@SELF_KOJO
IF FLAG:口上使用 <= 0
	RETURN 0
ENDIF

;Kがついてるのは歴史的経緯かなんかだろうか。
TRYCALLFORM SELF_KOJO_K{NO:TARGET}

;-------------------------------------------------
;@SINGLE_ENDING関係
;単体エンドの条件を満たした時に出力します
;-------------------------------------------------
@SINGLE_ENDING

;単体エンド条件はまったく思いついておりませんが一応揃える
;地の文……
TRYCALLFORM SINGLE_ENDING_K{NO:TARGET}

;---------------------------------------------------------------------------
;ToDo:レズプレイとか地の文に入り込んでる台詞（WAGS氏いうところの前口上）を
;口上側で置き換えられるようにしたい
;ない場合は地の文残しで
;---------------------------------------------------------------------------

@KOJO_LESPLAY,ARG,ARG:1
TRYCCALLFORM KOJO_LESPLAY_{NO:ARG},ARG:1
CATCH
CALL MAEKOJO_LESPLAY,ARG,ARG:1
ENDCATCH

@KOJO_NTR_STAFF,ARG
TRYCCALLFORM KOJO_NTR_STAFF_{NO:ARG}
CATCH
CALL MAEKOJO_NTR_STAFF
ENDCATCH


