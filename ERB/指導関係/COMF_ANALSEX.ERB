;-------------------------------------------------
;Ａ処女を奪うかどうかの確認
;-------------------------------------------------
@CONFIRM_LOST_ANALVIRGIN
SIF !FLAG:Ａ処女確認
	RETURN 1
$INPUT_LOOP_01
IF ISＡ処女(TARGET)
	PRINTFORML %CALLNAME:TARGET%のＡ処女を奪いますか？
	CALL GET_はいいいえ()
	RETURN RESULT == COMMAND_はい
ENDIF
RETURN 1


;-------------------------------------------------
;調教者の射精チェック（アナルセックス）
;-------------------------------------------------
@COM_EJAC_PLAYER_ANALSEX
;獣姦の場合はそのまま終了
SIF TEQUIP:獣姦プレイ
	RETURN 0

;調教者の射精ゲージ増加量
B = 0

;正常位アナル
IF SELECTCOM == [[TRAIN:正常位アナル]]
	;調教対象のABL:技巧をみる
	IF ABL:技巧 == 0
		B = 1500
	ELSEIF ABL:技巧 == 1
		B = 1600
	ELSEIF ABL:技巧 == 2
		B = 1800
	ELSEIF ABL:技巧 == 3
		B = 2000
	ELSEIF ABL:技巧 == 4
		B = 2400
	ELSE
		B = 3000
	ENDIF

	;調教対象のABL:従順をみる
	IF ABL:信頼 == 0
		TIMES B , 0.80
	ELSEIF ABL:信頼 == 1
		TIMES B , 0.90
	ELSEIF ABL:信頼 == 2
		TIMES B , 1.00
	ELSEIF ABL:信頼 == 3
		TIMES B , 1.10
	ELSEIF ABL:信頼 == 4
		TIMES B , 1.20
	ELSE
		TIMES B , 1.30
	ENDIF
;後背位アナル
ELSEIF SELECTCOM == [[TRAIN:後背位アナル]]
	;ABL:技巧をみる
	IF ABL:技巧 == 0
		B = 2700
	ELSEIF ABL:技巧 == 1
		B = 2800
	ELSEIF ABL:技巧 == 2
		B = 2900
	ELSEIF ABL:技巧 == 3
		B = 3100
	ELSEIF ABL:技巧 == 4
		B = 3200
	ELSE
		B = 3300
	ENDIF
;対面座位アナル
ELSEIF SELECTCOM == [[TRAIN:対面座位アナル]]
	;ABL:技巧をみる
	IF ABL:技巧 == 0
		B = 800
	ELSEIF ABL:技巧 == 1
		B = 1000
	ELSEIF ABL:技巧 == 2
		B = 1200
	ELSEIF ABL:技巧 == 3
		B = 1400
	ELSEIF ABL:技巧 == 4
		B = 1600
	ELSE
		B = 1800
	ENDIF

	;ABL:従順をみる
	IF ABL:信頼 == 0
		TIMES B , 1.00
	ELSEIF ABL:信頼 == 1
		TIMES B , 1.30
	ELSEIF ABL:信頼 == 2
		TIMES B , 1.60
	ELSEIF ABL:信頼 == 3
		TIMES B , 1.90
	ELSEIF ABL:信頼 == 4
		TIMES B , 2.10
	ELSE
		TIMES B , 2.40
	ENDIF
;背面座位アナル
ELSEIF SELECTCOM == [[TRAIN:背面座位アナル]]
	;ABL:技巧をみる
	IF ABL:技巧 == 0
		B = 900
	ELSEIF ABL:技巧 == 1
		B = 1100
	ELSEIF ABL:技巧 == 2
		B = 1300
	ELSEIF ABL:技巧 == 3
		B = 1500
	ELSEIF ABL:技巧 == 4
		B = 1700
	ELSE
		B = 1900
	ENDIF

	;ABL:従順をみる
	IF ABL:信頼 == 0
		TIMES B , 1.00
	ELSEIF ABL:信頼 == 1
		TIMES B , 1.10
	ELSEIF ABL:信頼 == 2
		TIMES B , 1.20
	ELSEIF ABL:信頼 == 3
		TIMES B , 1.30
	ELSEIF ABL:信頼 == 4
		TIMES B , 1.40
	ELSE
		TIMES B , 1.50
	ENDIF
;騎乗位アナル
ELSEIF SELECTCOM == [[TRAIN:騎乗位アナル]]
	;ABL:技巧をみる
	IF ABL:技巧 == 0
		B = 1000
	ELSEIF ABL:技巧 == 1
		B = 1300
	ELSEIF ABL:技巧 == 2
		B = 1700
	ELSEIF ABL:技巧 == 3
		B = 2200
	ELSEIF ABL:技巧 == 4
		B = 3000
	ELSE
		B = 4500
	ENDIF

	;ABL:従順をみる
	IF ABL:信頼 == 0
		TIMES B , 0.80
	ELSEIF ABL:信頼 == 1
		TIMES B , 0.90
	ELSEIF ABL:信頼 == 2
		TIMES B , 1.00
	ELSEIF ABL:信頼 == 3
		TIMES B , 1.10
	ELSEIF ABL:信頼 == 4
		TIMES B , 1.20
	ELSE
		TIMES B , 1.30
	ENDIF

	;ABL:奉仕技術をみる
	IF ABL:奉仕技術 == 0
		TIMES B , 0.30
	ELSEIF ABL:奉仕技術 == 1
		TIMES B , 0.70
	ELSEIF ABL:奉仕技術 == 2
		TIMES B , 1.00
	ELSEIF ABL:奉仕技術 == 3
		TIMES B , 1.20
	ELSEIF ABL:奉仕技術 == 4
		TIMES B , 1.50
	ELSE
		TIMES B , 1.80
	ENDIF
ENDIF

;調教対象のABL:欲望をみる
IF ABL:欲望 == 0
	TIMES B , 1.00
ELSEIF ABL:欲望 == 1
	TIMES B , 1.10
ELSEIF ABL:欲望 == 2
	TIMES B , 1.20
ELSEIF ABL:欲望 == 3
	TIMES B , 1.30
ELSEIF ABL:欲望 == 4
	TIMES B , 1.40
ELSE
	TIMES B , 1.50
ENDIF

;ABL:性交技術をみる
IF ABL:性交技術 == 0
	TIMES B , 1.00
ELSEIF ABL:性交技術 == 1
	TIMES B , 1.10
ELSEIF ABL:性交技術 == 2
	TIMES B , 1.20
ELSEIF ABL:性交技術 == 3
	TIMES B , 1.30
ELSEIF ABL:性交技術 == 4
	TIMES B , 1.40
ELSE
	TIMES B , 1.50
ENDIF

;PALAM:潤滑をみる
IF PALAM:潤滑 < PALAMLV:1
	TIMES B , 0.40
ELSEIF PALAM:潤滑 < PALAMLV:2
	TIMES B , 0.70
ELSEIF PALAM:潤滑 < PALAMLV:3
	TIMES B , 1.00
ELSEIF PALAM:潤滑 < PALAMLV:4
	TIMES B , 1.30
ELSEIF PALAM:潤滑 >= PALAMLV:4
	TIMES B , 1.60
ENDIF

;プレイヤーのABL:Ｃ感覚をみる
IF ABL:PLAYER:Ｃ感覚 == 0
	TIMES B , 1.00
ELSEIF ABL:PLAYER:Ｃ感覚 == 1
	TIMES B , 1.50
ELSEIF ABL:PLAYER:Ｃ感覚 == 2
	TIMES B , 2.00
ELSEIF ABL:PLAYER:Ｃ感覚 == 3
	TIMES B , 2.50
ELSEIF ABL:PLAYER:Ｃ感覚 == 4
	TIMES B , 3.50
ELSE
	TIMES B , 5.00
ENDIF

;EXP:Ａ経験をみる
;Ａ経験が多くなると少し下がる
IF EXP:Ａ経験 < EXPLV:1
	TIMES B , 1.50
ELSEIF EXP:Ａ経験 < EXPLV:2
	TIMES B , 1.00
ELSEIF EXP:Ａ経験 < EXPLV:3
	TIMES B , 0.90
ELSEIF EXP:Ａ経験 < EXPLV:4
	TIMES B , 0.80
ELSEIF EXP:Ａ経験 < EXPLV:5
	TIMES B , 0.70
ELSE
	TIMES B , 0.60
ENDIF

;EXP:Ａ拡張経験をみる
;Ａ拡張経験が多くなるとかなり下がる
IF TALENT:アンドロイド == 0
	IF EXP:Ａ拡張経験 < 1
		TIMES B , 1.00
	ELSEIF EXP:Ａ拡張経験 < 2
		TIMES B , 0.90
	ELSEIF EXP:Ａ拡張経験 < 3
		TIMES B , 0.70
	ELSEIF EXP:Ａ拡張経験 < 5
		TIMES B , 0.50
	ELSEIF EXP:Ａ拡張経験 < 8
		TIMES B , 0.30
	ELSE
		TIMES B , 0.10
	ENDIF
ENDIF

;コンドーム装着中だと下がる
IF TEQUIP:主人コンドーム || (ASSIPLAY && TEQUIP:助手コンドーム )
	TIMES B , 0.50
ENDIF

;射精ゲージ増加処理
SIF TALENT:PLAYER:ふたなり || TALENT:PLAYER:オトコ
	BASE:PLAYER:射精ゲージ += B

;射精処理
S = BASE:PLAYER:射精ゲージ
EJAC = MAXBASE:PLAYER:射精ゲージ

IF  S > EJAC * 2
	E = 2
ELSEIF S > EJAC
	E = 1
ELSE
	E = 0
ENDIF

;大量射精
IF E == 2
	EXP:PLAYER:射精経験 += 2
	EXP:精液経験 += 1
	PRINTL 大量射精
	PRINTL 精液経験＋１
	;Ｐに精液汚れ
	STAIN:PLAYER:2 |= 4

	BASE:PLAYER:射精ゲージ -= EJAC*2
	SIF BASE:PLAYER:射精ゲージ >= EJAC
		BASE:PLAYER:射精ゲージ = EJAC-1

	;セックスで射精フラグ
	TFLAG:セックスで射精 = 2
;通常の射精
ELSEIF E == 1
	EXP:PLAYER:射精経験 += 1
	;Ｐに精液汚れ
	PRINTL 射精
	STAIN:PLAYER:2 |= 4

	BASE:PLAYER:射精ゲージ -= EJAC
	SIF BASE:PLAYER:射精ゲージ >= EJAC
		BASE:PLAYER:射精ゲージ = EJAC-1

	;セックスで射精フラグ
	TFLAG:セックスで射精 = 1
ENDIF

;-------------------------------------------------
;アナルセックス後の処理
;-------------------------------------------------
@COM_AFTER_ANAL_SEX
;-------------------------------------------------
;経験上昇
;-------------------------------------------------
S = 0
;Ａ感覚が高いほどＡ経験が入る
IF ABL:Ａ感覚 <= 1
	S += 3
ELSEIF ABL:Ａ感覚 <= 4
	S += 3
ELSEIF ABL:Ａ感覚 <= 7
	S += 4
ELSE
	S += 5
ENDIF
EXP:Ａ経験 += S
PRINTFORML Ａ経験+{S}
S = 0

EXP:性交経験 += 1
PRINTL 性交経験＋１

;獣姦の場合はここで終了
SIF TEQUIP:獣姦プレイ
	RETURN 0

;女同士ならレズ経験上昇
IF TALENT:オトコ == 0 && TALENT:PLAYER:オトコ == 0
	PRINTS EXPNAME:[[EXP:レズ経験]]
	PRINTL +5
	EXP:レズ経験 += 5
;男同士ならホモ経験上昇
ELSEIF TALENT:オトコ == 1 && TALENT:PLAYER:オトコ == 1
	PRINTS EXPNAME:[[EXP:ＢＬ経験]]
	PRINTL +7
	EXP:ＢＬ経験 += 7
ENDIF

IF SELECTCOM == [[TRAIN:背面座位アナル]]
	PRINTFORML %EXPNAME:[[EXP:Ｂ開発経験]]%+1
	EXP:Ｂ開発経験 += 1
ENDIF
;愛情経験
;正常位アナル
IF SELECTCOM == [[TRAIN:正常位アナル]]
	E = 3
;対面座位アナル
SIF SELECTCOM == [[TRAIN:対面座位アナル]]
	E = 4
;その他
ELSE
	E = 2
ENDIF

;調教対象が男性なら＋１
SIF TALENT:オトコ
	E += 1

IF CFLAG:好感度 >= 1000 && ASSIPLAY == 0
	PRINTFORML %EXPNAME:[[EXP:愛情経験]]%+{E}
	EXP:愛情経験 += E
ENDIF
E = 0

;主人によるセックスなら好感度上昇
IF ASSIPLAY == 0
	IF ABL:Ａ感覚 >= 3
		TFLAG:主人経験 += 2
	ELSE
		TFLAG:主人経験 += 1
	ENDIF
ENDIF

IF ASSI > 0 && ASSIPLAY
	R = NO:ASSI
	;助手が童貞で調教対象が処女
	;調教対象が処女
	IF ISＡ処女(TARGET)
		RELATION:TARGET:R += 20
		SIF RELATION:TARGET:R == 20
			RELATION:R = 120
		RELATION:ASSI:(NO:TARGET) += 20
		SIF RELATION:ASSI:(NO:TARGET) == 20
			RELATION:ASSI:(NO:TARGET) = 120
	ENDIF
	SIF RELATION:R > 1000
		RELATION:R = 1000
ENDIF


;-------------------------------------------------
;汚れの処理
;-------------------------------------------------
;奴隷のＡ⇔調教者のＰの汚れが移動
STAIN:4 |= STAIN:PLAYER:2
STAIN:PLAYER:2 |= STAIN:4
;
;
;